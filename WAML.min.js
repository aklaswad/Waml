!function(){"use strict";function a(){return i?i:(i=new AudioContext,j=new e(i),i)}function b(a){return 440*Math.pow(2,(a-69)/12)}function c(a){return 12*Math.log2(a/440)+69}function d(a){var b=k.getAudioContext();"undefined"==typeof a&&(a=1);var c=b.createOscillator(),d=b.createWaveShaper(),e=b.createGain();return d.curve=new Float32Array([1,1]),e.gain.value=a,c.connect(d),d.connect(e),c.start(),e}function e(a){return this.owners={},this.ownerAutoIndex=0,this.init(a),this}function f(a){this.ctx=a}function g(){}function h(){}var i,j;e.prototype.init=function(a){this.engine=a.createScriptProcessor(512,2,2);var b=this;this.engine.onaudioprocess=function(){var a,c,d,e,f,g,h,i;for(a in b.owners)for(d=b.owners[a],f=d.length,e=0;f>e;e++)if(c=d[e],c.param.value!==c.last)if(g=c.last=c.param.value,c.callback)c.callback(g);else for(h=c.destinations.length,i=0;h>i;i++)c.destinations[i].value=g};var c=a.createGain();c.gain.value=0,this.engine.connect(c),c.connect(a.destination)},e.prototype.add=function(a,b,c,d){var e=a.__watcher_id;e||(e=a.__watcher_id=this.ownerAutoIndex++,this.owners[e]=[]);var f={param:b,last:b.value};d?f.callback=d:f.destinations=!c instanceof Array?[c]:c,this.owners[e].push(f)},e.prototype.remove=function(a){delete this.owners[a.__watcher_id]},f.prototype=Object.create(AudioNode.prototype),f.prototype.createAudioParamBridge=function(a,b,c){var d=k.getAudioContext(),e=k.createDCOffset(1),f=d.createGain();e.connect(f),f.gain.value=a;var g,h=f.gain,i=b.length;for(g=0;i>g;g++)f.connect(b[g]);return j.add(this,h,b,c),h},f.prototype.multiply=function(a,b){var c=this.ctx.createGain();return c.gain.value=b,a.connect(c),{connect:function(a){return c.connect(a)}}},f.prototype.add=function(a,b){var c=k.createDCOffset(b),d=this.ctx.createGain();return d.gain.value=1,c.connect(d),a.connect(d),{connect:function(a){return d.connect(a)}}},f.prototype.destory=function(){j.remove(this)},g.prototype=Object.create(f.prototype),g.prototype.noteOn=function(){throw'Virtual method "WamlSynthesizer.noteOn" has called'},g.prototype.noteOff=function(){throw'Virtual method "WamlSynthesizer.noteOff" has called'},h.prototype=Object.create(f.prototype);var k={getAudioContext:a,Synthesizer:g,Effect:h,synthesizers:{},effects:{},registerSynthesizer:function(a){return this.validateSynthesizer(a)?(this.synthesizers[a.name]=a,void("undefined"!=typeof this.onmoduleload&&this.onmoduleload(a))):void this.console.error("Failed to load module")},registerEffect:function(a){return this.validateEffect(a)?(this.effects[a.name]=a,void("undefined"!=typeof this.onmoduleload&&this.onmoduleload(a))):void this.console.error("Failed to load module")},validateSynthesizer:function(a){return this.__validate(a,[])},validateEffect:function(a){return this.__validate(a,["inlet"])},__validate:function(a,b){var c,d,e;if(!a.name)return this.console.error("Cannot register unnamed module"),!1;for(c=a.name,e=b.length,d=0;e>d;d++)if(!a[b[d]])return this.console.error("Module: "+c+" does not have required info "+b[d]),!1;return!0},createSynthesizer:function(a){var b=this.synthesizers[a];if(!b)throw"synthesizer "+a+" is not found";return new b.create(this.getAudioContext())},createEffect:function(a){var b=this.effects[a];if(!b)throw"effect "+a+" is not found";return new b.create(this.getAudioContext())},describeAll:function(){console.log("/* Registered Synthesizers */"),console.log(this.synthesizers),console.log("/* Registered Effects */"),console.log(this.effects)},describe:function(a,b){"undefined"===b&&(b=console.log);var c=this.synthesizers[a]||this.effects[a];return c?(b("Name: "+a),void b("Author: "+c.author||"(unknown)")):void b("Module "+a+" is not registered")},console:console,createDCOffset:d,midi2freq:b,freq2midi:c};window.Waml=k}(),function(){function a(a,b){var c=Waml.getAudioContext(),d=c.createScriptProcessor(2048,1,1),e=document.getElementById(a),f=e.width,g=e.height,h=e.getContext("2d"),i=b.mutiplier||1;h.fillStyle=b.backgroundColor||"#fff",h.lineWidth="1px";var j=0,k={max:0,maxframe:0};d.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0);h.clearRect(0,0,f,g),h.fillRect(0,0,f,g),b.centerLine&&(h.strokeStyle=b.centerLine,h.beginPath(),h.moveTo(0,g/2),h.lineTo(f-1,g/2),h.stroke()),h.strokeStyle=b.waveColor||"#000",h.moveTo(0,g/2),h.beginPath();var e=0;for(c=0;f>c;c++){var l=[],m=4*c;l[0]=i*d[m],l[1]=i*d[m+1],l[2]=i*d[m+2],l[3]=i*d[m+3];var n,o=1,p=-1,q=0;for(n=1;4>n;n++)p<l[n]&&(p=l[n]),l[n]<o&&(o=l[n]),q<Math.abs(l[n])&&(q=Math.abs(l[n]));h.lineTo(c,g/2+-g/2*o),h.lineTo(c,g/2+-g/2*p),e=q}(k.max<e||k.maxframe<j-8)&&(k.max=e,k.maxframe=j),h.stroke(),j++};var l=c.createGain();return l.gain.value=0,l.connect(c.destination),d.connect(l),d}function b(a,b){var c=document.createElement("script");c.src=a,b&&(c.onload=b),document.body.appendChild(c)}Waml.Web={createWaveFormRenderer:a,loadScriptFromURL:b}}();