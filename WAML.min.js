!function(){"use strict";function a(){return i?i:(i=new AudioContext,j=new e(i),i)}function b(a){return 440*Math.pow(2,(a-69)/12)}function c(a){return 12*Math.log2(a/440)+69}function d(a){var b=k.getAudioContext();"undefined"==typeof a&&(a=1);var c=b.createOscillator(),d=b.createWaveShaper(),e=b.createGain();return d.curve=new Float32Array([1,1]),e.gain.value=a,c.connect(d),d.connect(e),c.start(),e}function e(a){return this.owners={},this.ownerAutoIndex=0,this.init(a),this}function f(a){this.ctx=a}function g(){}function h(){}var i,j;e.prototype.init=function(a){this.engine=a.createScriptProcessor(512,2,2);var b=this;this.engine.onaudioprocess=function(){var a,c,d,e,f,g,h,i;for(a in b.owners)for(d=b.owners[a],f=d.length,e=0;f>e;e++)if(c=d[e],c.param.value!==c.last)if(g=c.last=c.param.value,c.callback)c.callback(g);else for(h=c.destinations.length,i=0;h>i;i++)c.destinations[i].value=g};var c=a.createGain();c.gain.value=0,this.engine.connect(c),c.connect(a.destination)},e.prototype.add=function(a,b,c,d){var e=a.__watcher_id;e||(e=a.__watcher_id=this.ownerAutoIndex++,this.owners[e]=[]);var f={param:b,last:b.value};d?f.callback=d:f.destinations=!c instanceof Array?[c]:c,this.owners[e].push(f)},e.prototype.remove=function(a){delete this.owners[a.__watcher_id]},f.prototype=Object.create(AudioNode.prototype),f.prototype.createAudioParamBridge=function(a,b,c){var d=k.getAudioContext(),e=k.createDCOffset(1),f=d.createGain();e.connect(f),f.gain.value=a;var g,h=f.gain,i=b.length;for(g=0;i>g;g++)f.connect(b[g]);return j.add(this,h,b,c),h},f.prototype.multiply=function(a,b){var c=this.ctx.createGain();return c.gain.value=b,a.connect(c),{connect:function(a){return c.connect(a)}}},f.prototype.add=function(a,b){var c=k.createDCOffset(b),d=this.ctx.createGain();return d.gain.value=1,c.connect(d),a.connect(d),{connect:function(a){return d.connect(a)}}},f.prototype.destory=function(){j.remove(this)},g.prototype=Object.create(f.prototype),g.prototype.noteOn=function(){throw'Virtual method "WamlSynthesizer.noteOn" has called'},g.prototype.noteOff=function(){throw'Virtual method "WamlSynthesizer.noteOff" has called'},h.prototype=Object.create(f.prototype);var k={getAudioContext:a,Synthesizer:g,Effect:h,synthesizers:{},effects:{},registerSynthesizer:function(a){this.synthesizers[a.name]=a},registerEffect:function(a){this.effects[a.name]=a},createSynthesizer:function(a){var b=this.synthesizers[a];if(!b)throw"synthesizer "+a+" is not found";return new b.create(this.getAudioContext())},createEffect:function(a){var b=this.effects[a];if(!b)throw"effect "+a+" is not found";return new b.create(this.getAudioContext())},describe:function(){console.log("/* Registered Synthesizers */"),console.log(this.synthesizers),console.log("/* Registered Effects */"),console.log(this.effects)},createDCOffset:d,midi2freq:b,freq2midi:c};window.Waml=k}(),function(){function a(a,b){var c=Waml.getAudioContext();b||(b=1);var d=c.createScriptProcessor(2048,1,1),e=document.getElementById(a),f=e.getContext("2d");f.strokeStyle="#000";var g=0,h={max:0,maxframe:0};d.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0);f.clearRect(0,0,e.width,e.height),f.moveTo(0,100),f.beginPath();var i=0;for(c=0;512>c;c++){var j=[],k=4*c;j[0]=b*d[k],j[1]=b*d[k+1],j[2]=b*d[k+2],j[3]=b*d[k+3];var l,m=1,n=-1,o=0;for(l=1;4>l;l++)n<j[l]&&(n=j[l]),j[l]<m&&(m=j[l]),o<Math.abs(j[l])&&(o=Math.abs(j[l]));f.lineTo(c,100+-100*m),f.lineTo(c,100+-100*n),i=o}(h.max<i||h.maxframe<g-8)&&(h.max=i,h.maxframe=g),f.stroke(),g++};var i=c.createGain();return i.gain.value=0,i.connect(c.destination),d.connect(i),d}function b(a,b){var c=document.createElement("script");c.src=a,b&&(c.onload=b),document.body.appendChild(c)}Waml.Web={createWaveFormRenderer:a,loadScriptFromURL:b}}();