!function(){"use strict";function a(){return g?g:(g=new AudioContext,h=new e(g),g)}function b(a){return 440*Math.pow(2,(a-69)/12)}function c(a){return 12*Math.log2(a/440)+69}function d(a){var b=i.getAudioContext();"undefined"==typeof a&&(a=1);var c=b.createOscillator(),d=b.createWaveShaper(),e=b.createGain();return d.curve=new Float32Array([1,1]),e.gain.value=a,c.connect(d),d.connect(e),c.start(),e}function e(a){return this.owners={},this.ownerAutoIndex=0,this.init(a),this}function f(a){this.ctx=a}var g,h;e.prototype.init=function(a){this.engine=a.createScriptProcessor(512,2,2);var b=this;this.engine.onaudioprocess=function(){var a,c,d,e,f,g,h,i;for(a in b.owners)for(d=b.owners[a],f=d.length,e=0;f>e;e++)if(c=d[e],c.param.value!==c.last)if(g=c.last=c.param.value,c.callback)c.callback(g);else for(h=c.destinations.length,i=0;h>i;i++)c.destinations[i].value=g};var c=a.createGain();c.gain.value=0,this.engine.connect(c),c.connect(a.destination)},e.prototype.add=function(a,b,c,d){var e=a.__watcher_id;e||(e=a.__watcher_id=this.ownerAutoIndex++,this.owners[e]=[]);var f={param:b,last:b.value};d?f.callback=d:f.destinations=!c instanceof Array?[c]:c,this.owners[e].push(f)},e.prototype.remove=function(a){delete this.owners[a.__watcher_id]},f.prototype=Object.create(AudioNode.prototype),f.prototype.createAudioParamBridge=function(a,b,c){var d=i.getAudioContext(),e=i.createDCOffset(1),f=d.createGain();e.connect(f),f.gain.value=a;var g,j=f.gain,k=b.length;for(g=0;k>g;g++)f.connect(b[g]);return h.add(this,j,b,c),j},f.prototype.destory=function(){h.remove(this)};var i={getAudioContext:a,Module:f,modules:{},registerModule:function(a){return this.__validate(a)?(this.modules[a.name]=a,void("undefined"!=typeof this.onmoduleload&&this.onmoduleload(a))):void this.console.error("Failed to load module")},__validate:function(a){var b;return a.name?(b=a.name,a.isSynth||a.isEffect?!0:(this.console.error("Module must be synth or effect"),!1)):(this.console.error("Cannot register unnamed module"),!1)},createModule:function(a){var b=this.modules[a];if(!b)throw"Module '"+a+"' is not found";return new b.create(this.getAudioContext())},listSynthesizers:function(){var a,b=[];for(a in this.modules)this.modules[a].isSynth&&b.push(a);return b},listEffects:function(){var a,b=[];for(a in this.modules)this.modules[a].isEffect&&b.push(a);return b},describeAll:function(a){for(var b in this.modules)this.describe(b,a)},describe:function(a,b){"undefined"===b&&(b=console.log);var c=this.modules[a];return c?(b("Name: "+a),void b("Author: "+c.author||"(unknown)")):void b("Module "+a+" is not registered")},definition:function(a){return this.modules[a]},console:console,createDCOffset:d,midi2freq:b,freq2midi:c};window.Waml=i}(),function(){function a(a,b){var c=Waml.getAudioContext(),d=c.createScriptProcessor(2048,1,1),e=document.getElementById(a),f=e.width,g=e.height,h=e.getContext("2d"),i=b.mutiplier||1;h.fillStyle=b.backgroundColor||"#fff",h.lineWidth="1px";var j=0,k={max:0,maxframe:0};d.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0);h.clearRect(0,0,f,g),h.fillRect(0,0,f,g),b.centerLine&&(h.strokeStyle=b.centerLine,h.beginPath(),h.moveTo(0,g/2),h.lineTo(f-1,g/2),h.stroke()),h.strokeStyle=b.waveColor||"#000",h.moveTo(0,g/2),h.beginPath();var e=0;for(c=0;f>c;c++){var l=[],m=4*c;l[0]=i*d[m],l[1]=i*d[m+1],l[2]=i*d[m+2],l[3]=i*d[m+3];var n,o=1,p=-1,q=0;for(n=1;4>n;n++)p<l[n]&&(p=l[n]),l[n]<o&&(o=l[n]),q<Math.abs(l[n])&&(q=Math.abs(l[n]));h.lineTo(c,g/2+-g/2*o),h.lineTo(c,g/2+-g/2*p),e=q}(k.max<e||k.maxframe<j-8)&&(k.max=e,k.maxframe=j),h.stroke(),j++};var l=c.createGain();return l.gain.value=0,l.connect(c.destination),d.connect(l),d}function b(a,b){var c=document.createElement("script");c.src=a,b&&(c.onload=b),document.body.appendChild(c)}Waml.Web={createWaveFormRenderer:a,loadScriptFromURL:b}}();