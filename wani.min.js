!function(){"use strict";function a(){if(j)return j;var a=window.AudioContext||window.webkitAudioContext;return j=new a}function b(a,b,c){return"undefined"==typeof b&&(b=440),"undefined"==typeof c&&(c=69),b*Math.pow(2,(a-c)/12)}function c(a,b,c){return"undefined"==typeof b&&(b=440),"undefined"==typeof c&&(c=69),12*Math.log2(a/b)+c}function d(a){var b=l.getAudioContext();"undefined"==typeof a&&(a=1);var c=b.createOscillator(),d=b.createWaveShaper(),e=b.createGain();return d.curve=new Float32Array([1,1]),e.gain.value=a,c.connect(d),d.connect(e),c.start(0),e}function e(a,b,c){var e=a.createGain(),f=d(1);return Object.defineProperty(e,"value",{set:function(a){if("function"==typeof e.onchange){var b=e.onchange(a,e.__wani_value);if(!1===b)return}e.__wani_value=a,f.gain.value=a},get:function(){return e.__wani_value}}),e.__wani_value=f.gain.value=b,e.setValueAtTime=function(){AudioParam.prototype.setValueAtTime.apply(f.gain,arguments)},e.linearRampToValueAtTime=function(){AudioParam.prototype.linearRampToValueAtTime.apply(f.gain,arguments)},e.exponentialRampToValueAtTime=function(){AudioParam.prototype.exponentialRampToValueAtTime.apply(f.gain,arguments)},e.setTargetAtTime=function(){AudioParam.prototype.setTargetAtTime.apply(f.gain,arguments)},e.setValueCurveAtTime=function(){AudioParam.prototype.setValueCurveAtTime.apply(f.gain,arguments)},e.cancelScheduledValues=function(){AudioParam.prototype.cancelScheduledValues.apply(f.gain,arguments)},e.gain.value=1,e.onchange=c,f.connect(e),e}function f(a,c,d,e,f,g){var h;"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=128),e||(e=256);for(var i=Math.abs(c-d),j=new Float32Array(e),k=0;e>k;k++)j[k]=b(c+i*(k/e),f,g);return h=a.createWaveShaper(),h.curve=j,h}function g(a,b,c,e,g,h){var i=a.createGain(),j=f(a,b,c,e,g,h),k=Math.abs(b-c);i.gain.value=2/k,i.connect(j);var l=d(-(b+k/2));return l.connect(i),i.connect=function(){j.connect.apply(j,arguments)},i.disconnect=function(){j.disconnect.apply(j,arguments)},i}function h(a){this.ctx=a}function i(a){var b=l.getAudioContext(),c=l.createModule(a);this.name=a,this.modules=[c],this.muting=[c],this.playing={},this.values={},this.profile=l.definition(a);var d,e=this;for(d in this.profile.audioParams)this[d]=l.createAudioParam(b,c[d].value),this[d].connect(c[d]),c[d].value=0;for(d in this.profile.params)!function(a){Object.defineProperty(e,a,{set:function(b){e.values[a]=b;var c=this.modules.length,d=0;for(d=0;c>d;d++)e.modules[d][a]=b},get:function(){return e.values[a]}})}(d),this.values[d]=c[d];this.output=b.createGain(),c.connect(this.output);for(var f=0;8>f;f++)this.muting.push(this.wantInstance());return this}var j,k=AudioNode.prototype.connect;AudioNode.prototype.connect=function(){var a,b;try{k.apply(this,arguments)}catch(c){a=c,b=arguments[0],arguments[0]=b.input;try{k.apply(this,arguments)}catch(d){throw a}}},h.prototype.connect=function(){return this.output.connect.apply(this.output,arguments)},h.prototype.disconnect=function(){return this.output.disconnect.apply(this.output,arguments)},i.prototype=Object.create(h.prototype),i.prototype.wantInstance=function(){var a,b=(l.getAudioContext(),l.createModule(this.name));for(a in this.profile.audioParams)b[a].value=0,this[a].connect(b[a]);for(a in this.values)b[a]=this.values[a];return b.connect(this.output),this.modules.push(b),b},i.prototype.noteOn=function(a,b){var c;c=this.muting.length?this.muting.shift():this.wantInstance(),"undefined"==typeof this.playing[a]&&(this.playing[a]=[]),this.playing[a].push(c),c.noteOn(a,b)},i.prototype.noteOff=function(a){var b=this.playing[a].shift();"undefined"!=typeof b&&(b.noteOff(a),this.muting.push(b))};var l={getAudioContext:a,Module:h,modules:{},registerModule:function(a){return this.__validate(a)?(this.modules[a.name]=a,void("undefined"!=typeof this.onmoduleload&&this.onmoduleload(a))):void this.console.error("Failed to load module")},__validate:function(a){return a.name?!0:(this.console.error("Cannot register unnamed module"),!1)},createModule:function(a,b){if("undefined"==typeof b&&(b={}),b&&b.poly)return new i(a);var c=this.modules[a];if(!c)throw"Module '"+a+"' is not found";var d=new c.create(this.getAudioContext(),b);d.profile=c;for(var e in c.audioParams)d[e].profile=c.audioParams[e];return d},list:function(a){var b,c=[];for(b in this.modules)this.modules[b].type===a&&c.push(b);return c},describeAll:function(a){for(var b in this.modules)this.describe(b,a)},describe:function(a,b){"undefined"===b&&(b=console.log);var c=this.modules[a];return c?(b("Name: "+a),void b("Author: "+c.author||"(unknown)")):void b("Module "+a+" is not registered")},definition:function(a){return this.modules[a]},console:console,createDCOffset:d,createAudioParam:e,createMtofTilde:g,midi2freq:b,freq2midi:c,applyPreset:function(a,b){var c,d=a.profile;if("undefined"!=typeof d&&"undefined"!=typeof d.presets){var e=d.presets[b];if("undefined"!=typeof e){for(c in presets.audioParams)a[c].value=e.audioParams[c];for(c in presets.params)a[c]=e.params[c]}}},siglog:function(a,b){var c=0,d=a.createScriptProcessor(8192,1,1);b||(b="siglog"),d.onaudioprocess=function(a){if(!(c++%4)){var d=a.inputBuffer.getChannelData(0);console.log(b+":",d[0])}};var e=a.createGain();return e.gain.value=0,d.connect(e),e.connect(a.destination),d}};window.Wani=l}(),function(){function a(a,b){var c=Wani.getAudioContext(),d=c.createScriptProcessor(2048,1,1),e=document.getElementById(a),f=e.width,g=e.height,h=e.getContext("2d"),i=b.mutiplier||1;h.fillStyle=b.backgroundColor||"#fff",h.lineWidth="1px";var j=0,k={max:0,maxframe:0};d.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0);h.clearRect(0,0,f,g),h.fillRect(0,0,f,g),b.centerLine&&(h.strokeStyle=b.centerLine,h.beginPath(),h.moveTo(0,g/2),h.lineTo(f-1,g/2),h.stroke()),h.strokeStyle=b.waveColor||"#000",h.moveTo(0,g/2),h.beginPath();var e=0;for(c=0;f>c;c++){var l=[],m=4*c;l[0]=i*d[m],l[1]=i*d[m+1],l[2]=i*d[m+2],l[3]=i*d[m+3];var n,o=1,p=-1,q=0;for(n=1;4>n;n++)p<l[n]&&(p=l[n]),l[n]<o&&(o=l[n]),q<Math.abs(l[n])&&(q=Math.abs(l[n]));h.lineTo(c,g/2+-g/2*o),h.lineTo(c,g/2+-g/2*p),e=q}(k.max<e||k.maxframe<j-8)&&(k.max=e,k.maxframe=j),h.stroke(),j++};var l=c.createGain();return l.gain.value=0,l.connect(c.destination),d.connect(l),d}function b(a,b){var c=document.createElement("script");c.src=a,b&&(c.onload=b),document.body.appendChild(c)}Wani.Web={createWaveFormRenderer:a,loadScriptFromURL:b}}(),function(){"use strict";function a(){var a=this;Object.defineProperty(this,"type",{set:function(b){a._osc.type=b},get:function(){return a._osc.type}})}a.prototype.connect=function(a){if("undefined"!=typeof a.profile){var b=a.profile();this.__profile.range=b.range,this._gain=ctx.createGain,this._gain.gain.value=0,this._osc=ctx.createOscillator,this._osc.frequency.value=0,this.range=Wani.createAudioParam(ctx,0),this._osc.connect(this._gain),this.range.connect(this._gain.gain),this.speed=this._osc.frequency,this._osc.start()}},a.prototype.disconnect=function(){this._gain.disconnect.apply(this._gain,arguments)},Wani.registerModule({name:"LFO",create:a,type:"synth",audioParams:{range:{range:[0,1]},center:{range:[0,1]},speed:{range:[0,20]}}})}();